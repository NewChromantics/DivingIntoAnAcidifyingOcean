<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="Web/win95.css" />
	<link rel="stylesheet" type="text/css" href="Web/Hud.css" />
<style>

	body
	{
		background-color:	#000;
		color:				#ccc;	/* text colour */
	}

	#Hud
	{
		pointer-events:	none;
		/*	need a static position to make z index work */
		position:		relative;
		z-index:		100;
	}

	input
	{
		/* always allow pointer events on inputs */
		pointer-events:	auto !important;
	}

</style>
</head>
<body>

	<div id="Hud">
		<div id="Music">Music: <span id="MusicLabel">Track</span></div>
		<div id="Year">Year: <span id="YearLabel">000</span></div>
		<div id="Timeline">Timeline: <input type=range id="YearSlider" /></div>
	</div>
	
	<script src='PopEngineCommon/PopWebApi.js'></script>
	<script src='PopEngineCommon/PopWebOpenglApi.js'></script>
	<script src='PopEngineCommon/PopWebGuiApi.js'></script>
	<script src='PopEngineCommon/PopWebImageApi.js'></script>
	<script>
		
		async function Bootup()
		{
			const UrlParams = window.location.search.toLowerCase().replace('?',' ').trim().split('&');
			console.log('UrlParams',UrlParams);
			const AsyncAssetLoads = UrlParams.includes('AsyncAssets');
			
			//	preload some assets that we don't load asynchronously
			let AssetPromises = [];
			let Load = async function(Filename)
			{
				//	can either await each one, or accumulate
				if ( AsyncAssetLoads )
				{
					let Promise = Pop.AsyncCacheAssetAsString(Filename);
					AssetPromises.push( Promise );
				}
				else
				{
					await Pop.AsyncCacheAssetAsString(Filename);
				}
			}
			
			//	gr: ideally, if we're async loading all these, we don't await each one...
			//		make it a big array!
			await Load('Timeline.json');
			await Load('CameraSpline.dae.json');
			
			for ( let i=1;	i<=4;	i++ )
			{
				//Load('Ocean/ocean_pts.' + (''+i).padStart(4,'0') + '.ply');
			}
			for ( let i=1;	i<=10;	i++ )
			{
				await Load('Ocean/ocean_pts.' + (''+i).padStart(4,'0') + '.ply.mesh.json');
			}
			
			await Load('Shell/shellFromBlender.obj');
			await Load('Quad.vert.glsl');
			await Load('ParticleTriangles.vert.glsl');
			await Load('ParticleColour.frag.glsl');
			await Load('BlitCopy.frag.glsl');
			await Load('Geo.vert.glsl');
			await Load('Colour.frag.glsl');
			await Load('Edge.frag.glsl');
			await Load('PhysicsIteration_UpdateVelocity.frag.glsl');
			await Load('PhysicsIteration_UpdatePosition.frag.glsl');

			await Load('AssetManager.js');
			await Load('Hud.js');
			await Load('PopEngineCommon/PopShaderCache.js');
			await Load('PopEngineCommon/PopFrameCounter.js');
			await Load('PopEngineCommon/PopCamera.js');
			await Load('PopEngineCommon/PopMath.js');
			await Load('PopEngineCommon/ParamsWindow.js');
			await Load('PopEngineCommon/PopPly.js');
			await Load('PopEngineCommon/PopObj.js');
			await Load('PopEngineCommon/PopCollada.js');
			await Load('PopEngineCommon/PopTexture.js');
			await Load('Noise0.png');

			console.log("AssetPromises:",AssetPromises);
			await Promise.all( AssetPromises );
			let Source = await Pop.LoadFileAsStringAsync('bootup.js');
			Pop.CompileAndRun( Source, 'bootup.js' );
		}

		Bootup().then( e=>Pop.Debug("Finished!",e) ).catch( console.error );
	
	</script>
	
</body>

